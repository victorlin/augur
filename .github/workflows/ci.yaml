name: CI
on:
  push:
    branches:
      - master

  # Routinely check that tests pass with new versions of dependencies.
  schedule:
    # Every day at 17:42 UTC / 9:42 Seattle (winter) / 10:42 Seattle (summer)
    - cron: "42 17 * * *"

  pull_request:

  workflow_dispatch:

  workflow_call:
    inputs:
      version:
        required: true
        type: string

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - run: |
        echo "github.workflow_ref: ${{ github.workflow_ref }}"
    - run: |
        echo "github.event.repository.default_branch: ${{ github.event.repository.default_branch }}"
    - run: |
        echo "github.event_name: ${{ github.event_name }}"

  release:
    # Only run when called by the release workflow on the default branch
    if: github.event_name == 'workflow_call' && github.workflow_ref == format('{0}/.github/workflows/release.yaml@refs/heads/{1}', github.repository, github.event.repository.default_branch)
    needs: [test]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          # Fetch all branches and tags.
          fetch-depth: 0
